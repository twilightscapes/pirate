---
import BaseLayout from "@/layouts/Base.astro";
import "@pagefind/default-ui/css/ui.css";

const meta = {
  title: "Search",
  description: "Search page",
  articleDate: new Date().toISOString(),
  ogImage: "/path/to/default/og-image.png"
};
---
<BaseLayout meta={meta}>
  <h1>Search</h1>
  <div class="search-container">
    {
      import.meta.env.DEV ? (
        <div class="mx-auto text-center">
          <p>
            Search is only available in production builds. <br />
            Try building and previewing the site to test it out locally.
          </p>
        </div>
      ) : (
        <div id="pirate__search" />
      )
    }
  </div>
</BaseLayout>
<script>
  // only add pagefind in production
  if (!import.meta.env.DEV) {
    const onIdle = window.requestIdleCallback || ((cb) => setTimeout(cb, 1));
    onIdle(async () => {
      const { PagefindUI } = await import("@pagefind/default-ui");
      new PagefindUI({
        baseUrl: import.meta.env.BASE_URL,
        bundlePath: import.meta.env.BASE_URL.replace(/\/$/, "") + "/pagefind/",
        element: "#pirate__search",
        showImages: false,
        showSubResults: true,
      });
    });
  }
</script>

<style is:global>
  :root {
    --pagefind-ui-font: inherit;
  }

  #pirate__search .pagefind-ui__search-clear {
    width: calc(60px * var(--pagefind-ui-scale));
    padding: 0;
    background-color: transparent;
    overflow: hidden;
  }
  #pirate__search .pagefind-ui__search-clear:focus {
    outline: 1px solid theme("colors.accent-2");
  }
  #pirate__search .pagefind-ui__search-clear::before {
    content: "";
    -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' %3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12'%3E%3C/path%3E%3C/svg%3E")
      center / 60% no-repeat;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' %3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12'%3E%3C/path%3E%3C/svg%3E")
      center / 60% no-repeat;
    background-color: theme("colors.accent");
    display: block;
    width: 100%;
    height: 100%;
  }

  #pirate__search .pagefind-ui__result {
    border: 0;
  }

  #pirate__search .pagefind-ui__result-link {
    background-size: 100% 6px;
    background-position: bottom;
    background-repeat: repeat-x;
    background-image: linear-gradient(
      transparent,
      transparent 5px,
      theme("colors.textColor") 5px,
      theme("colors.textColor")
    );
  }

  #pirate__search .pagefind-ui__result-link:hover {
    text-decoration: none;
    background-image: linear-gradient(
      transparent,
      transparent 4px,
      theme("colors.link") 4px,
      theme("colors.link")
    );
  }

  #pirate__search mark {
    color: theme("colors.quote");
    background-color: transparent;
    font-weight: 600;
  }
</style>

<style>
  #pirate__search {
    --pagefind-ui-primary: theme("colors.accent");
    --pagefind-ui-text: theme("colors.textColor");
    --pagefind-ui-background: theme("colors.bgColor");
    --pagefind-ui-border: theme("colors.zinc.400");
    --pagefind-ui-border-width: 1px;
  }
</style>

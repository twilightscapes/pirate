---
import ThemeToggle from "../ThemeToggle.astro";
import Search from "../Search.astro";
import Switch from "@/components/Switch.jsx";
import { getMenuLinks } from "@/site-config";
import { getEntry } from 'astro:content';

const url = new URL(Astro.request.url);
const siteSettings = await getEntry('siteSettings', 'main');
const { showHeader, showLogo, showTheme, showSearch, showSwitch, logoImage, defaultView } = siteSettings.data;
const menuLinks = await getMenuLinks();
---

{showHeader && (
  <div id="menu" class="menu header">
    {showLogo && logoImage && (
      <a href="/" aria-current={url.pathname === "/" ? "page" : false}>
        <img 
          src={`${logoImage}`}
          alt="Site Logo"
          class="cornerlogo"
          style={{
            position: "relative",
            top: "1%",
            left: "10px",
            padding: "0",
            maxHeight: "60px",
            maxWidth: "90px"
          }}
          loading="eager"
          fetchpriority="high"
          width="90px"
          height="60px"
        />
      </a>
    )}

    <ul class="topmenu" style={{ fontSize: "clamp(.6rem, 1.6vw, 1.8rem)",
      textAlign: "center",
      display: "flex",
      justifyContent: "space-around",
      gap: "4vw",
      alignItems: "center",
      margin: "0 auto",
      padding: "0",
      height: '60px'
    }}>
      {menuLinks.map((link) => (
        <li>
          <a
            href={link.path}
            class="px-4 py-4 sm:py-0 sm:hover:underline"
            aria-current={url.pathname === link.path ? "page" : false}
            rel="prefetch"
            data-astro-reload
          >
            {link.title}
          </a>
        </li>
      ))}
    </ul>

    <div id="missioncontrol" class="missioncontrol sitecontrols" style={{
      display: "flex",
      justifyContent: "space-around",
      fontSize: "clamp(.8rem, 2.3vw, 2.5rem)",
      gap: "3vw",
      alignItems: "center",
      padding: "0 10px 0 0",
    }}>
      {showSearch && <Search />}
      {/* {showSwitch && <Switch client:load />} */}
      {showSwitch && <Switch client:load defaultView={defaultView} />}
      {showTheme && <ThemeToggle />}
    </div>
    
  </div>


)}
  
  <button id="back-to-top" style="
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #333;
  color: white;
  padding: 10px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  z-index: 1000;
">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 19V5M5 12l7-7 7 7"/>
  </svg>
</button>
  <script>
    document.addEventListener('astro:page-load', () => {
      const backToTopButton = document.getElementById('back-to-top');
    
      if (backToTopButton) {
        window.addEventListener('scroll', () => {
          if (window.pageYOffset > 100) {
            backToTopButton.style.display = 'block';
          } else {
            backToTopButton.style.display = 'none';
          }
        });

        backToTopButton.addEventListener('click', () => {
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      }
    });
  </script>